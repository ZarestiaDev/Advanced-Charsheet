<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
	<!-- adds more width for saveview -->
	<template name="spell_action_saveview">
		<string_spellactionview name="saveview">
			<anchored to="saveviewlabel" position="righthigh" offset="7,0" width="104" />
			<subroll>save</subroll>
		</string_spellactionview>
	</template>
	
	<template name="spell_action_attackview">
		<string_spellactionview name="attackview">
			<anchored to="attackviewlabel" position="righthigh" offset="7,0" width="104" />
			<subroll>atk</subroll>
		</string_spellactionview>
	</template>
	
	<windowclass name="spell_class" merge="join">
		<sheetdata>
			<number_spell name="dcmisc" source="dc.misc">
				<anchored to="dcstatmod" position="righthigh" offset="5,0" width="22" />
			</number_spell>
		</sheetdata>
	</windowclass>

	<!-- Change to center view -->
	<windowclass name="spell_header" merge="join">
		<sheetdata>
			<windowlist name="actionsmini" merge="replace">
				<anchored>
					<top offset="2" />
					<left anchor="center" offset="0" />
					<right parent="rightanchor" anchor="left" relation="relative" offset="-5" />
				</anchored>
				<datasource>.actions</datasource>
				<class>spell_action_mini</class>
				<noscroll />
				<readonly />
				<columns width="25" fillwidth="true" />
				<invisible />
			</windowlist>

			<string_spell name="name" merge="replace">
				<anchored>
					<top offset="2" />
					<left parent="hanchor" anchor="right" relation="relative" offset="5" />
					<right anchor="center" offset="-10" />
				</anchored>
				<multilinespacing>20</multilinespacing>
				<empty textres="library_recordtype_empty_spell" />
				<script>
					function onDoubleClick(x, y)
						window.activatePower();
						
						return true;
					end
					
					function onDragStart(button, x, y, draginfo)
						local node = window.getDatabaseNode();
						if not node then
							return false;
						end
						
						local nLevel = 0;
						local nodeSpellLevel = node.getChild("...");
						if nodeSpellLevel then
							nLevel = tonumber(string.sub(nodeSpellLevel.getName(), 6)) or 0;
						end
						
						draginfo.setType("spellmove");
						draginfo.setStringData(getValue());
						draginfo.setNumberData(nLevel);
						draginfo.setDatabaseNode(node);
						
						return true;
					end
				</script>
			</string_spell>
		</sheetdata>
	</windowclass>
</root>
